<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Citibank</title>
<style>
  body { font-family: Arial; margin:0; background:#f2f2f2; }
  .topbar { background:#003366; color:white; padding:15px; display:flex; align-items:center; justify-content:space-between; }
  .topbar span { font-size:24px; cursor:pointer; margin-right:10px; }
  .sidebar { width:220px; background:#fff; position:fixed; top:0; left:-220px; height:100%; padding-top:60px; transition:0.3s; box-shadow:2px 0 10px rgba(0,0,0,.1); z-index:9999; }
  .sidebar a { display:block; padding:15px; color:#003366; text-decoration:none; font-weight:500; }
  .sidebar a:hover { background:#f0f0f0; }
  .content { margin-left:20px; padding:20px; max-width:1000px; margin-top:20px; }
  .profile-pic { width:120px; height:120px; border-radius:50%; border:3px solid #003366; margin-bottom:15px; object-fit:cover; }
  button { padding:10px 20px; margin:5px; background:#003366; color:white; border:none; border-radius:5px; cursor:pointer; }
  button:hover { background:#0055a5; }
</style>
<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body onload="initDashboard()">

<div class="topbar">
  <span onclick="toggleMenu()">‚ò∞</span>
  <h2>Dashboard</h2>
  <button onclick="logout()">Logout</button>
</div>

<div class="sidebar" id="sidebar">
  <a href="Dashboard.html">Dashboard</a>
  <a href="kyc.html">KYC</a>
  <a href="history.html">Transaction History</a>
  <a href="admin.html">Admin Panel</a>
</div>

<div class="content">
  <img id="photo" class="profile-pic" src="">
  <h2 id="name"></h2>
  <p>Account No: <span id="acct"></span></p>
  <h3>Balance: $<span id="balance"></span></h3>
  <button onclick="locked()">Transfer</button>
  <button onclick="locked()">Withdraw</button>
</div>

<script>
  // Initialize Supabase
  const supabaseUrl = 'https://aaljhxyrqnewvhejtoik.supabase.co';
  const supabaseKey = 'sb_publishable_52hZQtxrDZB4k_fLi8S0GQ_j5wma9lz';
  const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

  let currentUser = null;

  async function initDashboard() {
    const { data: { user }, error } = await supabase.auth.getUser();
    if(error || !user){
      window.location.href = "index.html";
      return;
    }

    // Fetch user profile from Supabase
    const { data, error: profileError } = await supabase
      .from('users')
      .select('*')
      .eq('id', user.id)
      .single();

    if(profileError || !data){
      alert("Error fetching user data");
      return;
    }

    currentUser = data;
    renderDashboard();
  }

  function renderDashboard() {
    document.getElementById("name").textContent = currentUser.name;
    document.getElementById("acct").textContent = currentUser.acct;
    document.getElementById("balance").textContent = Number(currentUser.balance).toLocaleString();
    document.getElementById("photo").src = currentUser.photo || "https://via.placeholder.com/120";
  }

  function locked() {
    alert("Account Restricted üîê\nContact Support");
  }

  function toggleMenu() {
    const s = document.getElementById("sidebar");
    s.style.left = s.style.left === "0px" ? "-220px" : "0px";
  }

  async function logout() {
    const { error } = await supabase.auth.signOut();
    if(error){
      alert("Logout failed");
      return;
    }
    window.location.href = "index.html";
  }
</script>

</body>
</html>
