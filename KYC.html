
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KYC - Citibank</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 500px;
    margin: auto;
    background: #fff;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
  }
  h2 { text-align: center; color: #003366; }
  input, button {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  button {
    background: #003366;
    color: #fff;
    border: none;
    cursor: pointer;
  }
  button:hover { background: #0055a5; }
  #status { text-align: center; color: red; font-size: 14px; }
</style>
</head>
<body>

<div class="container">
  <h2>KYC Upload</h2>
  <input type="file" id="passport" accept="image/*" />
  <button id="btnUpload">Upload Passport</button>
  <p id="status"></p>
</div>

<script type="module">
import { auth, db, storage } from './js/firebase.js';
import { ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js';
import { doc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

const passportInput = document.getElementById("passport");
const btnUpload = document.getElementById("btnUpload");
const status = document.getElementById("status");

onAuthStateChanged(auth, user => {
  if (!user) window.location.href = "index.html";

  btnUpload.addEventListener("click", async () => {
    const file = passportInput.files[0];
    if (!file) {
      status.textContent = "Please select a file!";
      return;
    }

    try {
      status.textContent = "Uploading...";
      const storageRef = ref(storage, `passports/${user.uid}/${file.name}`);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);

      // Save URL in Firestore
      const userRef = doc(db, "users", user.uid);
      await updateDoc(userRef, { passportURL: url });

      status.style.color = "green";
      status.textContent = "Upload successful ✅";

    } catch(err) {
      console.error(err);
      status.style.color = "red";
      status.textContent = "Upload failed ❌";
    }
  });
});
</script>

</body>
</html>
