<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transaction History - Citibank</title>
<style>
  body { font-family: Arial; margin:0; background:#f4f6f8; }
  
  /* Topbar */
  .topbar { background:#003366; color:white; padding:15px; display:flex; align-items:center; justify-content:space-between; }
  .topbar h2 { margin:0; }
  .topbar button { background:#ff4d4f; color:white; border:none; border-radius:8px; padding:8px 15px; cursor:pointer; }

  /* Sidebar */
  .sidebar { width:220px; background:#fff; position:fixed; top:0; left:-220px; height:100%; padding-top:60px; transition:0.3s; box-shadow:2px 0 10px rgba(0,0,0,.1); z-index:1000; }
  .sidebar a { display:block; padding:15px; color:#003366; text-decoration:none; font-weight:500; }
  .sidebar a:hover { background:#f0f0f0; }

  /* Content */
  .content { margin-left:20px; padding:20px; max-width:800px; margin-top:20px; }
  .transaction-card { background:white; border-radius:12px; padding:15px 20px; margin-bottom:15px; box-shadow:0 5px 15px rgba(0,0,0,0.05); display:flex; justify-content:space-between; align-items:center; }
  .tx-info { display:flex; flex-direction:column; }
  .tx-type { font-weight:600; font-size:16px; }
  .tx-date { font-size:14px; color:#555; }
  .tx-amount { font-weight:600; font-size:16px; }
  .tx-deposit { color:green; }
  .tx-withdraw { color:red; }

  @media(max-width:768px){
    .content { margin-left:10px; padding:10px; }
    .transaction-card { flex-direction:column; align-items:flex-start; }
    .tx-amount { margin-top:5px; }
  }
</style>
</head>
<body onload="loadHistory()">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<div class="topbar">
  <h2>Transaction History</h2>
  <button onclick="logout()">Logout</button>
</div>

<div class="sidebar" id="sidebar">
  <a href="Dashboard.html">Dashboard</a>
  <a href="kyc.html">KYC</a>
  <a href="history.html">Transaction History</a>
  <a href="admin.html">Admin Panel</a>
</div>

<div class="content">
  <h3>Your Transactions</h3>
  <div id="historyList"></div>
</div>

<script>
const SUPABASE_URL = 'https://aaljhxyrqnewvhejtoik.supabase.co';
const SUPABASE_KEY = 'sb_publishable_52hZQtxrDZB4k_fLi8S0GQ_j5wma9lz';
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let currentUser;

// Load transaction history from Supabase
async function loadHistory() {
  const stored = localStorage.getItem("currentUser");
  if(!stored) return window.location.href="index.html";
  currentUser = JSON.parse(stored);

  // Fetch user transactions from Supabase
  const { data:transactions, error } = await supabase
    .from('transactions')
    .select('*')
    .eq('username', currentUser.username)
    .order('date', { ascending:false });

  const container = document.getElementById("historyList");
  container.innerHTML = "";

  if(error){
    container.innerHTML = `<p style="color:red;">Failed to load transactions: ${error.message}</p>`;
    return;
  }

  if(!transactions || transactions.length === 0){
    container.innerHTML = `<p style="text-align:center;">No transactions yet</p>`;
    return;
  }

  transactions.forEach(tx => {
    const div = document.createElement("div");
    div.className = "transaction-card";
    div.innerHTML = `
      <div class="tx-info">
        <span class="tx-type ${tx.type==="Deposit" ? "tx-deposit" : "tx-withdraw"}">${tx.type}</span>
        <span class="tx-date">${new Date(tx.date).toLocaleString()}</span>
      </div>
      <div class="tx-amount ${tx.type==="Deposit" ? "tx-deposit" : "tx-withdraw"}">$${tx.amount.toFixed(2)}</div>
    `;
    container.appendChild(div);
  });
}

// Sidebar toggle
function toggleMenu() {
  const s = document.getElementById("sidebar");
  s.style.left = s.style.left === "0px" ? "-220px" : "0px";
}

// Logout
function logout() {
  localStorage.removeItem("currentUser");
  window.location.href="index.html";
}
</script>

</body>
</html>
