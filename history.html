<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transaction History - Citibank</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; display:flex; }

  /* Sidebar */
  .sidebar {
    width:60px; background:#003366; color:white; height:100vh; padding-top:20px; display:flex; flex-direction:column; align-items:center;
  }
  .sidebar a { color:white; text-decoration:none; display:flex; flex-direction:column; align-items:center; padding:15px 0; width:100%; font-size:18px; }
  .sidebar a.active { background:#0055a5; }
  .sidebar a:hover { background:#0055a5; }

  /* Content */
  .content { flex:1; display:flex; justify-content:center; align-items:flex-start; padding:40px; }

  /* Card */
  .card { background:white; border-radius:12px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,0.05); text-align:center; max-width:600px; width:100%; }
  .transaction-card { display:flex; justify-content:space-between; padding:12px 15px; border-bottom:1px solid #eee; }
  .tx-type { font-weight:600; }
  .tx-deposit { color:green; }
  .tx-withdraw { color:red; }
  .tx-date { color:#555; font-size:14px; }

  h3 { margin-bottom:15px; color:#003366; }
</style>
</head>
<body>

<div class="sidebar">
  <a href="Dashboard.html" id="link-dashboard">ğŸ <span>Dash</span></a>
  <a href="kyc.html" id="link-kyc">ğŸ“<span>KYC</span></a>
  <a href="history.html" id="link-history">ğŸ“œ<span>History</span></a>
  <a href="admin.html" id="link-admin">ğŸ› ï¸<span>Admin</span></a>
  <a href="index.html" id="logoutLink">ğŸšª<span>Logout</span></a>
</div>

<div class="content">
  <div class="card">
    <h3>Your Transactions</h3>
    <div id="historyList">Loading...</div>
  </div>
</div>

<script type="module">
import { supabase } from './supabase.js';

// Highlight active menu
document.getElementById('link-history').classList.add('active');

// Logout
document.getElementById("logoutLink").addEventListener("click", async () => {
  await supabase.auth.signOut();
  location.href = "index.html";
});

// Load transactions
async function loadHistory() {
  const { data: { user }, error: authError } = await supabase.auth.getUser();
  if(authError || !user) location.href="index.html";

  const { data, error } = await supabase
    .from("users")
    .select("transaction_history")
    .eq("id", user.id)
    .single();

  if(error || !data) { document.getElementById("historyList").innerText="No transactions found."; return; }

  const container = document.getElementById("historyList");
  container.innerHTML = "";

  if(!data.transaction_history || data.transaction_history.length === 0) {
    container.innerText = "No transactions found.";
    return;
  }

  data.transaction_history.forEach(tx => {
    const div = document.createElement("div");
    div.className = "transaction-card";
    div.innerHTML = `
      <div>
        <span class="tx-type ${tx.type === "Deposit" ? "tx-deposit" : "tx-withdraw"}">${tx.type}</span>
        <div class="tx-date">${tx.date}</div>
      </div>
      <div>
        $${tx.amount.toFixed(2)}
      </div>
    `;
    container.appendChild(div);
  });
}

loadHistory();
</script>

  <script>
function logout() {
  // Clear all stored user data
  localStorage.removeItem("currentUser");
  sessionStorage.clear();

  // Redirect to login page
  window.location.href = "index.html";
}
</script>
  
</body>
</html>
