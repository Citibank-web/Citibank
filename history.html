<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transaction History</title>
<style>
  body { font-family: Arial; padding:20px; background:#f2f2f2; }
  table { width:100%; border-collapse: collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 5px 20px rgba(0,0,0,0.1); }
  th, td { padding:12px; border-bottom:1px solid #ddd; text-align:left; }
  th { background:#003366; color:#fff; }
</style>
</head>
<body>

<h2>Transaction History</h2>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Type</th>
      <th>Amount</th>
      <th>Balance</th>
    </tr>
  </thead>
  <tbody id="transactionsBody">
    <!-- Transactions will populate here -->
  </tbody>
</table>

<script type="module">
import { auth, db } from './js/firebase.js';
import { collection, query, where, getDocs, orderBy } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

const transactionsBody = document.getElementById("transactionsBody");

onAuthStateChanged(auth, async user => {
  if (!user) window.location.href = "https://github.com/Citibank-web/Citibank/blob/main/index.html";

  // Fetch transactions
  const q = query(collection(db, "transactions"), where("uid", "==", user.uid), orderBy("date", "desc"));
  const querySnapshot = await getDocs(q);

  querySnapshot.forEach(docSnap => {
    const t = docSnap.data();
    const row = `<tr>
      <td>${new Date(t.date.seconds*1000).toLocaleString()}</td>
      <td>${t.type}</td>
      <td>$${t.amount.toFixed(2)}</td>
      <td>$${t.balance.toFixed(2)}</td>
    </tr>`;
    transactionsBody.innerHTML += row;
  });
});
</script>

</body>
</html>
