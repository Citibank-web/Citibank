<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KYC - Citibank</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; display:flex; }
  
  /* Sidebar */
  .sidebar {
    width:60px; background:#003366; color:white; height:100vh; padding-top:20px; display:flex; flex-direction:column; align-items:center;
  }
  .sidebar a { color:white; text-decoration:none; display:flex; flex-direction:column; align-items:center; padding:15px 0; width:100%; font-size:18px; }
  .sidebar a.active { background:#0055a5; }
  .sidebar a:hover { background:#0055a5; }

  /* Content */
  .content { flex:1; display:flex; justify-content:center; align-items:flex-start; padding:40px; }

  /* Card */
  .card { background:white; border-radius:12px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,0.05); text-align:center; max-width:400px; width:100%; }
  .profile-pic { width:120px; height:120px; border-radius:50%; border:3px solid #003366; object-fit:cover; margin-bottom:15px; cursor:pointer; transition:0.2s; }
  .profile-pic.selected { border:3px solid #3399ff; }
  input, button { display:block; width:100%; margin:10px 0; padding:10px; border-radius:5px; border:1px solid #ccc; font-size:16px; }
  button { background:#003366; color:white; border:none; cursor:pointer; }
  button:hover { background:#0055a5; }
  #status { color:green; font-weight:600; }
  .gallery { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
  .gallery img { width:60px; height:60px; border-radius:50%; cursor:pointer; border:2px solid #ccc; transition:0.2s; }
  .gallery img.selected { border:3px solid #003366; }
</style>
</head>
<body>

<div class="sidebar">
  <a href="Dashboard.html" id="link-dashboard">üè†<span>Dash</span></a>
  <a href="kyc.html" id="link-kyc">üìù<span>KYC</span></a>
  <a href="history.html" id="link-history">üìú<span>History</span></a>
  <a href="admin.html" id="link-admin">üõ†Ô∏è<span>Admin</span></a>
  <a href="#" id="logoutLink">üö™<span>Logout</span></a>
</div>

<div class="content">
  <div class="card">
    <h3>Update Profile Picture</h3>
    <div id="photoGallery" class="gallery"></div>

    <input type="text" id="fullName" placeholder="Full Name">
    <button id="updateBtn">Update Profile</button>
    <p id="status"></p>
  </div>
</div>

<script type="module">
import { supabase } from './supabase.js';

// Highlight active menu
document.getElementById('link-kyc').classList.add('active');

// Logout
document.getElementById("logoutLink").addEventListener("click", async () => {
  await supabase.auth.signOut();
  location.href = "index.html";
});

let currentUser;
let selectedPhoto = "";

// Example photos for gallery
const profileLinks = [
  "https://swiftdelivery8.wordpress.com/wp-content/uploads/2025/12/img-20251210-wa00086256583382535261714.jpg",
  "https://swiftdelivery8.wordpress.com/wp-content/uploads/2025/12/img-20251210-wa00066532014068741309807.jpg",
  "https://swiftdelivery8.wordpress.com/wp-content/uploads/2025/12/img-20250921-wa00001365510559851195658.jpg"
];

// Load user
async function loadKYC() {
  const { data: { user }, error: authError } = await supabase.auth.getUser();
  if(authError || !user) location.href="index.html";

  currentUser = user;

  const { data, error } = await supabase
    .from("users")
    .select("*")
    .eq("id", user.id)
    .single();

  if(error || !data) { alert("User not found!"); return; }

  selectedPhoto = data.photo;
  document.getElementById("fullName").value = data.full_name;

  renderGallery();
}

// Render gallery
function renderGallery() {
  const gallery = document.getElementById("photoGallery");
  gallery.innerHTML = "";
  profileLinks.forEach(link => {
    const img = document.createElement("img");
    img.src = link;
    if(selectedPhoto === link) img.classList.add("selected");
    img.onclick = () => { selectedPhoto = link; renderGallery(); };
    gallery.appendChild(img);
  });
}

// Update profile
document.getElementById("updateBtn").addEventListener("click", async () => {
  const fullName = document.getElementById("fullName").value.trim();
  if(!fullName) { alert("Name cannot be empty!"); return; }

  const { data, error } = await supabase
    .from("users")
    .update({ full_name: fullName, photo: selectedPhoto })
    .eq("id", currentUser.id);

  if(error) { alert("Update failed!"); return; }

  document.getElementById("status").innerText = "Profile updated ‚úÖ";
});

loadKYC();
</script>

</body>
</html>
