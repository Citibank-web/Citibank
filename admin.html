
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Citibank</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; display:flex; background:#f4f6f8; }

  /* Sidebar */
  .sidebar {
    width:60px; background:#003366; color:white; height:100vh; padding-top:20px; display:flex; flex-direction:column; align-items:center;
  }
  .sidebar a { color:white; text-decoration:none; display:flex; flex-direction:column; align-items:center; padding:15px 0; width:100%; font-size:18px; }
  .sidebar a.active { background:#0055a5; }
  .sidebar a:hover { background:#0055a5; }

  /* Content */
  .content { flex:1; padding:40px; display:flex; flex-direction:column; align-items:center; }

  h2 { color:#003366; margin-bottom:20px; }

  /* Table */
  table { border-collapse: collapse; width:100%; max-width:900px; background:white; border-radius:12px; overflow:hidden; box-shadow:0 8px 20px rgba(0,0,0,0.05); }
  th, td { padding:12px 15px; text-align:left; }
  th { background:#003366; color:white; }
  tr:nth-child(even) { background:#f4f6f8; }
  tr:hover { background:#e0e7ff; }

  button { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:600; margin:2px; }
  .approve { background:green; color:white; }
  .reject { background:red; color:white; }
  .create { background:#0066cc; color:white; margin-bottom:15px; }

  /* Form */
  #createUserForm { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
  #createUserForm input { padding:8px; border-radius:6px; border:1px solid #ccc; flex:1; min-width:120px; }
</style>
</head>
<body>

<div class="sidebar">
  <a href="Dashboard.html" id="link-dashboard">üè†<span>Dash</span></a>
  <a href="kyc.html" id="link-kyc">üìù<span>KYC</span></a>
  <a href="history.html" id="link-history">üìú<span>History</span></a>
  <a href="admin.html" id="link-admin" class="active">üõ†Ô∏è<span>Admin</span></a>
  <a href="#" id="logoutLink">üö™<span>Logout</span></a>
</div>

<div class="content">
  <h2>Admin Panel</h2>

  <form id="createUserForm">
    <input type="email" placeholder="Email" id="newEmail" required>
    <input type="password" placeholder="Password" id="newPassword" required>
    <input type="text" placeholder="Full Name" id="newFullName" required>
    <input type="text" placeholder="Account #" id="newAcct" required>
    <input type="number" placeholder="Balance" id="newBalance" required>
    <input type="text" placeholder="Photo URL" id="newPhoto" required>
    <button type="submit" class="create">Create User</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Account #</th>
        <th>Balance</th>
        <th>KYC</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="userTable"></tbody>
  </table>
</div>

<script type="module">
import { supabase } from './supabase.js';

// Password protection
const password = prompt("Enter Admin Password:");
if(password !== "Admin1234!") {
  alert("Unauthorized üîê");
  window.location.href = "index.html";
}

// Logout
document.getElementById("logoutLink").addEventListener("click", async () => {
  await supabase.auth.signOut();
  location.href = "index.html";
});

// Load all users
async function loadUsers() {
  const { data: { user }, error: authError } = await supabase.auth.getUser();
  if(authError || !user) location.href="index.html";

  const { data, error } = await supabase.from("users").select("*");
  if(error) return alert("Error loading users: " + error.message);

  const tbody = document.getElementById("userTable");
  tbody.innerHTML = "";

  data.forEach(u => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.full_name}</td>
      <td>${u.email}</td>
      <td>${u.account_number}</td>
      <td>$${u.balance.toFixed(2)}</td>
      <td>${u.kyc_done ? '‚úÖ' : '‚ùå'}</td>
      <td>
        <button class="approve" onclick="approveUser('${u.id}')">Approve</button>
        <button class="reject" onclick="rejectUser('${u.id}')">Reject</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Approve/reject placeholder functions
async function approveUser(id) {
  alert("Approved user: " + id);
}

async function rejectUser(id) {
  alert("Rejected user: " + id);
}

// Create user programmatically
document.getElementById("createUserForm").addEventListener("submit", async e => {
  e.preventDefault();
  const email = document.getElementById("newEmail").value;
  const password = document.getElementById("newPassword").value;
  const fullName = document.getElementById("newFullName").value;
  const acct = document.getElementById("newAcct").value;
  const balance = parseFloat(document.getElementById("newBalance").value);
  const photo = document.getElementById("newPhoto").value;

  const { data: authUser, error: authError } = await supabase.auth.admin.createUser({ email, password });
  if(authError) return alert("Error creating auth user: " + authError.message);

  const userId = authUser.user.id;

  const { data, error } = await supabase.from("users").insert([{
    id: userId,
    full_name: fullName,
    email,
    account_number: acct,
    balance,
    photo,
    kyc_done: false,
    transaction_history: []
  }]);
  if(error) return alert("Error creating user profile: " + error.message);

  alert("User created successfully!");
  document.getElementById("createUserForm").reset();
  loadUsers();
});

loadUsers();
</script>

</body>
</html>
